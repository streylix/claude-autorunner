#!/bin/bash
# Check and display bot status

STATUS_FILE="/tmp/claude-bot-status"
PID_FILE="/tmp/claude-bot.pid"
COMMAND_FILE="/tmp/claude-bot-commands"

# Colors
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "🤖 Claude Bot Status Check"
echo "=========================="

# Check PID file
if [ -f "$PID_FILE" ]; then
    PID=$(cat "$PID_FILE")
    echo -e "📋 PID File: ${GREEN}Found${NC} (PID: $PID)"
    
    # Check if process is running
    if ps -p $PID > /dev/null 2>&1; then
        echo -e "🔄 Process: ${GREEN}Running${NC}"
    else
        echo -e "🔄 Process: ${RED}Not Running${NC}"
    fi
else
    echo -e "📋 PID File: ${RED}Not Found${NC}"
fi

# Check status file
if [ -f "$STATUS_FILE" ]; then
    STATUS_LINE=$(cat "$STATUS_FILE")
    TIMESTAMP=$(echo "$STATUS_LINE" | cut -d: -f1)
    STATUS=$(echo "$STATUS_LINE" | cut -d: -f2)
    
    CURRENT_TIME=$(date +%s)
    AGE=$((CURRENT_TIME - TIMESTAMP))
    
    echo -e "📊 Status File: ${GREEN}Found${NC}"
    echo "   Last Update: $AGE seconds ago"
    echo "   Status: $STATUS"
    
    if [ $AGE -lt 30 ]; then
        echo -e "✅ Bot Status: ${GREEN}ONLINE${NC}"
    elif [ $AGE -lt 60 ]; then
        echo -e "⚠️  Bot Status: ${YELLOW}STALE${NC} (not updated recently)"
    else
        echo -e "❌ Bot Status: ${RED}OFFLINE${NC} (no recent updates)"
    fi
else
    echo -e "📊 Status File: ${RED}Not Found${NC}"
    echo -e "❌ Bot Status: ${RED}OFFLINE${NC}"
fi

# Check command file
if [ -f "$COMMAND_FILE" ]; then
    echo -e "📝 Command File: ${YELLOW}Exists${NC} (pending command)"
else
    echo -e "📝 Command File: Ready (no pending commands)"
fi

echo ""
echo "Test Commands:"
echo "  Send test: echo '!addmsg \"echo test\" 1' > $COMMAND_FILE"
echo "  Check log: tail -f /tmp/claude-bot.log"
echo "  Stop bot: python3 claudebot.py --stop"